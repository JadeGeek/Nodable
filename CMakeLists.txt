
cmake_minimum_required (VERSION 3.8)

# General :
#==========

# Declare project name
project ("Nodable")

# specify the C++ standard
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# Adds SDL2 folder to CMAKE_PREFIX_PATH
set(CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH}
"./libs/SDL2"
)

# If a default install prefix has not been set, we set it.
if(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
  set(CMAKE_INSTALL_PREFIX "${CMAKE_CURRENT_LIST_DIR}/install/${CMAKE_CONFIGURATION_TYPES}" CACHE PATH "..." FORCE)
endif()

# Find packages
find_package(OpenGL REQUIRED)
find_package(SDL2 REQUIRED)
find_package(MIRROR REQUIRED HINTS "./extern/mirror")

# Create a SOURCES variable that contains all source files
aux_source_directory( "./sources/" NODABLE)
aux_source_directory( "./extern/imgui" IMGUI)
aux_source_directory( "./extern/ImGuiColorTextEdit" TEXTEDIT)
aux_source_directory( "./libs/gl3w/GL" GL3W)

set(SOURCES
  ${NODABLE}
  ${GL3W}
  ${IMGUI}
  ${TEXTEDIT}    
  "./extern/imgui/examples/imgui_impl_opengl3.cpp"
  "./extern/imgui/examples/imgui_impl_sdl.cpp"
  ${MIRROR_SOURCES}
)

# Include headers
include_directories(
    "./extern"
    "./extern/imgui"
    "./extern/ImGuiColorTextEdit"
    "./extern/IconFontCppHeaders"
    "./libs"
    ${SDL2_INCLUDE_DIRS}
    "./libs/gl3w/GL"
    "./libs/gl3w"
    "./libs/glfw/include/GLFW"
    ${MIRROR_INCLUDE_DIRS}
)

# Build:
#=======

# Add an executable called Nodable(.exe on windows)
add_executable (Nodable "./sources/main" ${SOURCES})

# Link libraries
target_link_libraries(Nodable PUBLIC ${OPENGL_LIBRARY})
target_link_libraries(Nodable LINK_PUBLIC ${SDL2_STATIC}) # TODO: fix the mystery of "why should I have to link static at compile time and THEN use a DLL at runtime"

# Configure files (a link is created between source and target, if source is modified, target will be updated)
add_custom_command(
        TARGET Nodable PRE_BUILD

        COMMAND ${CMAKE_COMMAND} -E copy_directory  # Copy assets (fonts, scripts, etc..)
                ${CMAKE_CURRENT_SOURCE_DIR}/data
                ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/data

        COMMAND ${CMAKE_COMMAND} -E copy            # Copy SDL2 runtime library
                ${SDL2_RUNTIME}
                ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE})

# Installation :
#===============

# Copy DLLs
install(FILES ${SDL2_RUNTIME} DESTINATION ${CMAKE_INSTALL_PREFIX})

# Copy assets
install(DIRECTORY "data" DESTINATION ${CMAKE_INSTALL_PREFIX} )

# Copy executable
install(TARGETS Nodable DESTINATION ${CMAKE_INSTALL_PREFIX} )

# Tests :
#=========

# TODO: remove test at application startup and create a specific target for that.





# MMMMMMMMMMMMMMMMMMMMMMNOo:;,;;lxKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMW0o:;;;;;;;;lkXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# WWWWWWWWWMMMMMMMMMMWOc;;;;;:;;;;;:oKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# kxolllllxKWMMMMMMMMXo;;::ccccc:::;:xNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# NXOo;'''':xNMMMMMMMKc,,;;;;::;;;;,;oXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNXK0XWMMMMMMMMMMMMMMMMMMMMMMMMWNKKNMMMMMMMMMMMMMMMMMWNKKXWMMMMMMMMMMMMMMMMMMMM
# MMMXo''.'.,l0WMMMMMNd,'''''''''''':kNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0koc:;;oXMMMMMMMMMMMMMMMMMMMMWXOdl:;cOWMMMMMMMMMMMMWKOxlc;;xNMMMMMMMMMMMMMMMMMMMM
# MMMNo',,'...;dXWMMMMXd;'''''''''';dXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWX0o,',,lKWMMMMMMMMMMMMMMMMMMMMNKk:'':kWMMMMMMMMMMMMWXKOl,',oXMMMMMMMMMMMMMMMMMMMM
# MMMNo':xo,...':ONMMMMW0dc;,''',,';dXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO;'',lKWMMMMMMMMMMMMMMMMMMMMMMXl'';kWMMMMMMMMMMMMMMMWx,',oXMMMMMMMMMMMMMMMMMMMM
# MMMNo.:0NOc'...'oKWMMMMWNKOl';dxc,,cONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO;.''lKMMMMMMMMMMMMMMMMMMMMMMMXl.';kWMMMMMMMMMMMMMMMWx,.'oXMMMMMMMMMMMMMMMMMMMM
# MMMNo.:0WMXx,....;xNMMMMMMWd.;OWXd;',oO0kdoooodxOKNMMMMMMMMMMMWNKOkkOKNk,.''lKWMMMMMWX0OOkkOKNWMMMMMMXc..;kNNKOkkO0XWMMMMMMWx'.'oXMMMMMMMWX0Okkk0XWMMM
# MMMNo.:0WMMW0l.....c0WMMMMWd.,OWMW0c'''''.......',cxKWMMMMMMN0o:codxdol:'..'cKWMMWXxc:ldkxd:,:xNMMMMMXc..,oo:,''..';o0WMMMMWx'.'oXMMMMMXxlllolc;',lONM
# MMMNl.:0WMMMMNk;....'dXMMMWd.,OWMW0c'..'''''''''''.';xXMMMMKo',o0NWWWN0c....cKWMMKc..:ONMMWO;.'dNMMMMXc...,cdkOkd:...,dXMMMWd...oXMMMWk:,o0NWWN0c..'oX
# MMMNl.;0WMMMMMWKo.....:ONMWd.,OWWO:''''',,,,,,,,,'''''lKMM0:..lKWMMMMMWx'...cKMMMKc''lKWMMMK:..:KWMMMXc..'oKWMMMWNd'..'dNMMWd...lXMMWk,.:kKXXXXXx'..'d
# MMMNl.;0WMMMMMMMWO:.  ..lKNd.,OWKc'',,;;;;::::;;;;,,,''oNXl..,kWMMMMMMMk'...cKMMMMX0OXWWNKOo'..;0WMMMX:..'kWMMMMMMNo...;0WMWd...lXMMK:..,cllllllc;;;;o
# MMMNl.;0WMMMMMMMMMXd'   .,dl.'OWx,',,;;:ccllllcc::;;,'.:0O,..;OWMMMMMMMk....:KMMMMMWXOdoooxo'..;OWMMMX:..'xWMMMMMMMO'..'kWMWd...lXMMk'..oKXXXXXXXXXXXN
# MMMNc.;0WMMMMMMMMMMW0:.   .. 'ONx......',,;;;;;,,''....,Ok'  ,OWMMMMMMMk. ..:KMMMW0l,'ckKNW0;  ,OWMMMK:  'xWMMMMMMM0,  ,OWMWd. .lXMMk. .cXMMMMMMMMMMMM
# MMMNc ,0WMMMMMMMMMMMMNx'     'kWO,                    .:0O,  .oNMMMMMMMx. ..:KWMNd. .lXWMMMK;  ,OWMMMK;  .xWMMMMMMMk' .cKWMWo. .lXMM0,  'xWMMMMMMMMMXx
# MMMX; 'OWMMMMMMMMMMMMMWKl.   'kWNo.                  .'xNNo.  .dNMMMMMWd.  .:KWM0,  .dNMMMWO'  ,OWMMMK;  .xWMMMMMMXc..:0WMMWo. .cXMMNo.  .oKWMMMMWXx:c
# MWNd. .lXWMMMMMMMMMMMMMMNk,  .kWMNo.                 .cKWMNo.  .;dOK0ko,    .cxKK:   'okkdo:.  .lkOXMX:  .lXWMMMNO:.'oKWMMMNc   :KMMMXo.   .:lool:''l0
# dl;.....;ld0WMMMMMMMMMMMMMXo.'kWMXl.              ... .:kNMW0l,.....';lc..',;lxKN0c.. ..':dOo.  .,oKWW0l,..,:lllc;:d0NMMWKxl'...'lxKWMWOl'.    ..,oONW
# 0OOOOOOOOO0XWMMMMMMMMMMMMMMW0OXWXc. .coc,......',cxOx:. .;xXWWN0OxxkOXNX00XNNWWMMMWKOxkOKNWMWKkxOKNWMMMWNK0kxxxk0KNWMMMMWNK0000000KXWMMMWX0kxxkOKXWMMM
# MMMMMMMMMMMMMMMMMMMMMMMMWNKOkkOk;  .dXWWNX0OOO0KNWWMMNOc.  'oKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMMNkc'.       .dNMMMMMMMMMMMMMMMMMMW0o'  .cONMMMWNKOOOO0KNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMKc.          .oXMMMMMMMMMMMMMMMMMMMMWXd,  .;x0x:'.    ..,ckNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMXc .....''.... .dNMMMMMMMMMMMMMMMMMMMMMMNk:.  .            .;OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMM0'    ......    ;KMMMMMMMMMMMMMMMMMMMMMMMMNk'                'kWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMK,              cKMMMMMMMMMMMMMMMMMMMMMMMMM0,   ...........   :KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMWk.            ,kNMMMMMMMMMMMMMMMMMMMMMMMMMO.       ..        ,OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMWO:.        .cONMMMMMMMMMMMMMMMMMMMMMMMMMMX;                 :KWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMMMW0xl:;;:lx0NWMMMMMMMMMMMMMMMMMMMMMMMMMMMMO,               ;OWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMMMMMMWWWNWWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl.           .l0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
# MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0c.      .'ckXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
